#!/bin/bash

# Pre-commit hook for PR Monitor
# Runs SwiftLint and SwiftFormat checks
# Uses Mint for version-locked tools if available, falls back to Homebrew

set -e

echo "Running pre-commit checks..."

# Helper to run a tool via mint (preferred) or direct
run_tool() {
    local tool=$1
    shift
    if command -v mint &> /dev/null; then
        mint run $tool "$@"
    elif command -v $tool &> /dev/null; then
        $tool "$@"
    else
        echo "⚠ $tool not installed. Install via 'brew install mint && mint bootstrap' or 'brew install $tool'"
        return 1
    fi
}

# Check SwiftFormat
echo "→ Checking SwiftFormat..."
if run_tool swiftformat . --lint --quiet 2>/dev/null; then
    echo "✓ SwiftFormat passed"
else
    echo "❌ SwiftFormat check failed. Run 'swiftformat .' to fix."
    exit 1
fi

# Check SwiftLint
echo "→ Checking SwiftLint..."
if run_tool swiftlint --quiet 2>/dev/null; then
    echo "✓ SwiftLint passed"
else
    echo "❌ SwiftLint check failed. Run 'swiftlint' to see issues."
    exit 1
fi

echo "✅ All checks passed!"
